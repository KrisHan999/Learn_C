> 最初只有.c文件，渐渐地，人们发现在很多.c(.cpp)文件中的声明语句就是相同的，但他们却不得不一个字一个字地重复地将这些内容敲入每个.c(.cpp)文件。但更为恐怖的是，当其中一个声明有变更时，就需要检查所有的.c(.cpp)文件。
> 于是人们将重复的部分提取出来，放在一个新文件里,然后在需要的.c(.cpp)文件中敲入#include XXXX这样的语句。这样即使某个声明发生了变更，也再不需要到处寻找与修改了。因为这个新文件，经常被放在.c(.cpp)文件的头部，所以就给它起名叫做“头文件”，扩展名是.h。

**.h文件最初就是用来给变量和函数提供一些全局性的声明，这些声明被其他.c文件共享，方便变量和声明的修改，使得大型代码逻辑更清晰更易于维护**

1. **自定义头文件**

2. **重要！！！头文件与函数、变量声明**

### 自定义头文件

#### 重要

- 一般放一些重复使用的代码，例如**函数声明，变量声明，常量定义，宏的定义**等等。真正的函数实现还是在.c文件中

**在编译过程中，.h文件中的所有内容会被写到包含它的.c文件中，而所有的.c文件以一个共同的main函数作为可执行程序的入口。**

- #include <stdio.h>  

  #include "Hotel.h"  

  //**包含自定义头文件时使用双引号**

  //**使用<>时，系统寻找的是系统类库，而使用“”，系统寻找的是当前的目录的头文件**

若有多个源文件，分别编译最后链接在一起。

1.头文件的预编译，预处理

　　编译器在编译源代码时，会先编译头文件，保证每个头文件只被编译一次。

　　**在预处理阶段，编译器将c文件中引用的头文件中的内容全部写到c文件中。**

2.词法和语法分析（查错）

3.编译（汇编代码，.obj文件）

   转化为汇编码，这种文件称为目标文件。后缀为.obj。

4.链接（二进制机器码，.exe文件）

　　将汇编代码转换为机器码，生成可执行文件。

```c
#ifndef HOTELDEMO_HOTEL_H
#define HOTELDEMO_HOTEL_H

#define HOTEL1 872.0  //各家酒店的默认房费
#define HOTEL2 1383.0  //各家酒店的默认房费
#define HOTEL3 765.0  //各家酒店的默认房费
#define HOTEL4 1465.0  //各家酒店的默认房费

#define DISCOUNT 0.95

//菜单函数：显示菜单选项，接收并返回用户的收入
int menu(void);
//返回预定的入住天数
int getNight(void);
//根据入住的天数显示最终需要支付的金额
void showPrice(double);


#endif //HOTELDEMO_HOT
```

### 2.头文件与函数、变量声明

#### 1.变量声明

变量的声明有两种情况：

1、一种是**需要建立存储空间**的。例如：对于基本数据类型，**声明的同时会进行初始化相当于定义**就已经建立了存储空间。int a 在声明的时候就已经建立了存储空间。

2、另一种是**不需要建立存储空间**的。 例如：**extern int a** 其中变量a是在别的文件中定义的。

3、static变量声明：　　　　

　    (1)对于**局部变量用static**声明，则是为该变量分配的空间在**整个程序的执行期内都始终存在**。

        (2)**全局变量**用static来声明，则该变量的**作用只限于本文件模块**。

#### 2.变量定义

**定义是说：“在这里建立变量”或“在这里建立函数”。它为名字分配存储空间。**无论定义的是函数还是变量，编译器都要为它们在定义点分配存储空间。 对于变量，编译器确定变量的大小，然后在内存中开辟空间来保存其数据，对于函数，编译器会生成代码，这些代码最终也要占用一定的内存。

例如：类A

如果A a;就是一个声明，告诉编译器a是A类的一个对象变量，但是不进行初始化，不分配空间；如果以后a=new A();这就是初始化，分配了空间。

**尤其要注意的是：在头文件中不能定义变量或者函数，如果有多个源文件包含这个头文件，会出现重复定义的错误**

#### 3.函数的声明和定义

**函数，对于函数也一样，也是定义和声明，**函数的定义和声明是有区别的：

- **定义函数要有函数体**

- **声明函数没有函数体(还有以分号结尾)**

### 3.补充

**什么是定义？什么是声明？它们之间的区别是什么？**

所谓定义就是（编译器）创建一个对象，为这个对象分配一块内存，并给它取上一个名字，这个名字就是就是我们经常所说的变量名或对象名。

声明有2重含义：

　　（1） 告诉编译器，这个名字已经匹配到一块内存上，下面的代码用到变量或者对象是在别的地方定义的。声明可以出现多次。

　　（2） 告诉编译器，这个名字已经被预定了，别的地方再也不能用它来作为变量名或对象名。

定义和声明的最重要区别就是：

**定义创建对象并为这个对象分配了内存，声明没有分配内存。**

最好不要傻嘻嘻的在头文件里定义什么东西。比如全局变量：  

```c
/*xx头文件*/
 #ifndef _XX_头文件.H
 #define _XX_头文件.H
 int A;     //最好改为 extern int A
 #endif
```

虽然在上面说基本数据类型声明的同时进行初始化定义，但是经过实验在头文件中如果`int A`，不同的.c文件编译后A具有相同的地址。但是最好还是使用外部声明`extern int A;`，确保头文件中只有声明没有定义，这样如果头文件被多个源文件使用，不会出现重复定义的问题。

### 4.extern关键字

这个关键字真的比较可恶，**在定义变量的时候，这个extern居然可以被省略(定义时，默认均省略)**；**在声明变量的时候，这个extern必须添加在变量前**，所以有时会让你搞不清楚到底是声明还是定义。或者说，变量前有extern不一定就是声明，而变量前无extern就只能是定义。注：定义要为变量分配内存空间；而声明不需要为变量分配内存空间。

下面分变量和函数两类来说：

（1）变量

　　尤其是对于变量来说。  

1. **extern int a;//声明一个全局变量a**

2. int a; //定义一个全局变量a ，初始化位0

3. extern int a =0 ;//定义一个全局变量a 并给初值，一般使用4。  

4. int a =0;//定义一个全局变量a,并给初值

**第四个等于第三个，都是定义一个可以被外部使用的全局变量，并给初值**。 糊涂了吧，他们看上去可真像。**但是定义只能出现在一处**。也就是说，不管是int a；还是extern int a=0；还是int a=0;都只能出现一次（实验证明int a;可以出现多次，并且具有相同的地址），而那个extern int a可以出现很多次。

**当你要引用一个全局变量的时候，你就必须要声明，extern int a**;

（2）函数  
**函数，对于函数也一样，也是定义和声明，定义的时候用extern，说明这个函数是可以被外部引用的**，声明的时候用extern说明这是一个声明。 但由于**函数的定义和声明是有区别的**，**定义函数要有函数体，声明函数没有函数体(还有以分号结尾)**，**所以函数定义和声明时都可以将extern省略掉**，反正其他文件也是知道这个函数是在其他地方定义的，所以不加extern也行。两者如此不同，所以省略了extern也不会有问题。  

比如我们定义了一个全局函数：

```c
/*某cpp文件*/

int fun(void)

{

   　return 0;

}
```

我们对它做了个声明，然后后面就可以用了。加不加extern都一样

```c
/*另一cpp文件*/
int fun(void);
```

我们也可以把对fun的声明 放在一个头文件里，最后变成这样

```c
/*fun.h*/
int fun(void);   //函数声明，所以省略了extern，完整些是extern int fun(void);


/*对应的fun.cpp文件*/

int fun(void)

{

　　 return 0;

}//一个完整的全局函数定义，因为有函数体，extern同样被省略了。
```

**总结：**

**对变量而言**，如果你想**在本源文件(例如文件名A)中使用另一个源文件(例如文件名B)的变量**，方法有2种：

**(1)在A文件中必须用extern声明在B文件中定义的变量(当然是全局变量)；`extern int A;`**

**(2)在A文件中添加B文件对应的头文件，当然这个头文件包含B文件中的变量声明，也即在这个头文件中必须用extern声明 该变量**，否则，该变量又被定义一次。

**对函数而言**，如果你想在本源文件(例如文件名A)中使用另一个源文件(例如文件名B)的函数，方法有2种：

**(1)在A文件中用extern声明在B文件中定义的函数**(其实，也可省略extern，只需在A文件中出现B文件的函数声明即可)；

**(2)在A文件中添加B文件对应的头文件，当然这个头文件包含B文件中的函数声明，在头文件中函数可以不用加extern。**

### 5.关于全局变量的几点声明

关于全局变量的几点说明：

①默认情况下，C语言中的全局变量和函数的作用域仅限于定义和声明这个函数或变量的内部，如果需要从这个C文件之外访问这些函数或者全局变量就需要使用 extern关键字进行声明，这是因为**C编译器是以C文件为单位进行编译的，如果多个文件定义的相同的函数或者变量，编译器将无法找到这个函数或者变量的定义，从而给出该函数或者变量重复定义的错误。**

②**static关键字用于全局变量的声明时**，作用类似于函数的情况，**这个全局变量的作用域将局限在声明该变量的c文件内部，这个c文件之外的代码将无法访问这个变量。**编译的时候将会出现类似undeference to "xxx"的报错，它是找不到xxx的，因为使用static相当于进行了文件隔离。
